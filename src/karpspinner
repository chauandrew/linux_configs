#!/bin/bash

read -r -d '' usage << USAGE
Usage: karpspinner [PID]
Magikarp flops while you wait for a process to finish

EXAMPLE: 'sleep 5 & karpspinner $!'
USAGE

# process long and short args 
for arg in "$@"; do
  shift
  case "$arg" in
    "--help") set -- "$@" "-h" ;;
	*) set -- "$@" "$arg";;
  esac
done

while getopts v:d:rfht option
do
   case "${option}"
   in
   h) echo "$usage"; exit 0;;
   esac
done


PID=$1

exec < /dev/tty

# Get cursor position
oldstty=$(stty -g)
stty raw -echo min 0
echo -en "\033[6n" > /dev/tty
# tput u7 > /dev/tty    # when TERM=xterm (and relatives)
IFS=';' read -r -d R -a pos
stty $oldstty
# change from one-based to zero based so they work with: tput cup $row $col
row=$((${pos[0]:2} - 1))    # strip off the esc-[
col=$((${pos[1]}))

# Ascii art images: 
read -r -d '' hikarp << 'HIKARP'
.
.                                                                              
.                                                                              
.                                   ,▄▄                                        
.                                   ▓▓▓▓▄                                      
.                                   ▐▓▒╢▓▓▄                                    
.                                    ▓▌ ╙▒▓█▄                                  
.                     ,              ▐▓   ╙▒▓█,                                
.                   ▐▓▀▓▌             ▓▌    ╢▓▓▌    ,╥╥,                       
.                   ▓▓╙▒▓▌         ,,g▓Γ     ╙╢▓▓▓▓▓▀`▓▓                       
.                 ▄▓▀  ║▒▓▌       ╫▓▀▀▀      ░ ╙▒▓,,╓ä▓▓▄▄╖,,                  
.               ╓█▀     ║▒▓▌       ▓█   `      . ║▒▒▒▒▒▒▒▒▀▀▀▓▓▓▄▄,            
.               ▓▌       ▒▒▓▄     ▐▓▄╓          \ ╢▓▒▒║╜`  ▄ `╙▒▒▒▀▓▓w         
.               ▓▌      ░ ▒▒▓▄  ▄█▓▒▒▒▒▒╢H╓,     \]▒▓▒          ▒▒▒▒▒▀▓▄,      
.              ▄▓▌        ╙▒▒▓▄█▓▒▒▒▒▒▒▒▒╢▒▒▒╣N╓,─]▒▓▒h,      ╓╣▒▒▒▒▒╜╜╙▓█▄    
.            ╓█▀         `.]▒▒▀▒▒▒▒▒▒▒▒▒▒▒▒▒╢▒▒▒▒╢╣▒▒▒▒▒▒╢╢▒╜╜▒▒▒▒▒  ▄▄,░ ▀█   
.           ╒▓▀`            ▒▒▒▒▒▒▒▒▒▒▒▒▒╢▒▒╢▒▒▒▒▒▒▒▒▒▒▒▒╨`,╖▒▒▒▒▒░  ▀███  ▓▓  
.           ▓▓       `   ░,║▒▒▒╢▒▒▒▒▒▒▒▒╣▒▒▒╢▒▒▒▒▒▒▒▒▒▒▒▒ ▒▒▒▒▒▒▒▒▒░   ██ ,▓▌  
.          ╓▓▀        ╓╥@╢▒▒▒▒▒╢▒▒▒▒▒▒▒▒▒╢▒▒╢▒▒▒▒▒▒▒▒▒▒▒  ▒▒▒▒▒▒▒╢╢@░   ╙ ▓▓   
.        █▓▓▒╓╖mm@@╬╢╢╣╢╣╢╢╣╣▒▒╢▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░ ║▒▒▒╢╣▒▒╢▒╫╖   ▓▓    
.        ▀▓▓▓▓▓▓▓▓▓▓▓▓▀▀▀▀▀▀▓▓╣╣╢▒▒▒▒▒▒▒▒▒▒▒▒╢▒▒▒▒▒▒▒▒▒▒C,╢▒▒╢▒▒▒╢╢╢╢╫▓▓▓▀     
.                            ▀▓▓▓▓╣╣Ñ╙"""╙╙╜╨╝╬╣▒▒▒▒▒▒╢╣ ▒╣╣╢╢╢╣╢╢╢╣╢▓▓▀       
.                           ░ ░ ▓▓▓             ╫╣╢╣╢╣╝,▒╣╣╢╢╢╣▓╢▓▓▓▓▀         
.                             ▄▓▓`  ,      .     ╙▓▓╝,▒▓╢╢▓▓╜╜▓▓▀▀"            
.                           ╒▓▓▒p░▄▒╓    ╓▒     ` ,▒▄▓█▀▀▓▓░╓▓▀                
.                            ▀▀▀▀▀▀▀▓▌▄▄▓▓▓▓@,«─▒▓▓▓▀"  ▓▓░░▓▌                 
.                                    "▀▀▀▓▓▓▓▓█▄▓▀      ▓▓░▐▓                  
.                                                       ▓▓░▓▓                  
.                                                        ▀▓▓█                  
.                                                                              
.
.
.
.
.
.
.
.
. . Loading . . .
HIKARP

read -r -d '' lokarp << "LOKARP"
.
.
.
.
.
.
.
.
.
.                                                   ╓▄▄▄
.                                                   ▓▓▓▓▌
.                                                   █▌╢▓█
.                                                  ▐▓░░╫▓▌
.                                                  ▓█,░╟▓█
.                                                 ╓▓▌  ░╫▓▌
.                                               ,▄█▀  ▒░║▓█
.                                             ╓▓█▀\    ░░╫▓▌
.                                      ,▄▄▄▄╖▄▓▌   `.  ]░╫▓▓
.                                      ▓▓▒▒▀▀▀▒p@╖   \  ░░╫▓▌╖
.                                   ▄▓█▓▓▒╢╢╢╢╢╢╣╢▓╗  . ▒╟▓╣▒▓▓█▄▄,
.                                g▓█▀▒╣╣╣╢╢╢╢╢╢╢╢╫╣╢▓╖ ╖▒╫▓╣╢╣╢╜╙▀▀█▓╖
.                              ╓██▒▒╣╣╢╢╢╣▒╣╣╢╣╢╫╢╢╢╣╣▓▒╠╢▓╣╢╣▒    ▄"██
.                             ▄▓▓▒╣╣╣╢╢╢╢╣╢╢╣╢╢╣╣╢╣╢╣╢╢╣╢╣▒╣╣╢╢╗      ▓█▄
.                            ▓▓▓╣╣╢╢╢╣╣╢╢╣╢╣╣╣╣╣╢╣╢╢╣╢╢╣╣╢╣▒╢╣╣╢╢@╥╖╓@╣▒▓█
.                          ,▓█▒╢╢╢╢╢╢╢╢╢╢╣╢╣╣╢╢╣╢╣╣╢╣╣╢╢╣╢╣Ñ░▒▒@@╣╣╢╣╢▒╣▒▓█
.                     ,▄▄▓█▓▒▒╢╢╢╢╣╣╣╣╣╢╢╢╢╢╢╣╢╢╢╣╢╢╢╣╢╢╢╣╣░▒╣╢╢╢╣╢╢╣╣╣╢╝▓▓▄
.             ╓▄███▓▓▓▀▀Ñ╜╜▒▒╢╣╢╣╢╣╢╢▓╜╙╙╙╨╬╣╣╢╣╣╢╣╣╣╢╣╢╢╣▒░╢╢╢╢╢╢╢╣▒▒░░▒░░▓█
.             ▓█▒╙╜╜╙`', ' ╓╣╢╢▓▓▓▓╜░░░░░░░░░░╫╣╣╣╣╣╢╢╢╢╢╣░▒╣╢╢╣╢╢╣╣▒▒░▐█▒▒▐▓[
.              ▐▓U~─`   ,╓╬╣╢▓▓▓▓▓▄▄▓▒░░░░▒░░░░╟╣╣╢╢╢╢╣Ñ▒▒▒╢╢╣╢╢╢╣╢▒▒▒░█▀▒░▓█
.               ██   . ╓╬╢▓▓▓▓▓▄▄▓█▓▓▓╖╥╬▓▀░░░▒▒╙▓▓▓▒▒@▓▓╢╣╣╣╢╢╢╢╢╢▒▒▒░▒░▄█▓
.               ▓▓Ç ╓@▓▓▓▓█▀░█▓▓▓▓▓▒░░░░─```````░╜` "▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▀▀▀
.              ▓▓▓▓▓▓▓▓▀▀`    ▀▀▀▀▀▀▀▀▀█▓█▄µ,─`   ╓▓█▀▀▀▀▀▓▓█▀▒▄█▓▀
.              ╙▀██▀▀'                    ╙▀█▄,╓▄█▀      ▓█▒▒▓█▀
.                                            ╜▀▀╜       ▓▓▒▄█▀
.                                                       ▓▌▒█▌
.                                                       ▓▌▐▓Ç
.                                                       ▀█▄▓█
.                                                        ▐▓▓
. . Loading . .
LOKARP

read -r -d '' gyrados << 'GYRADOS'
.                                  ƒm
.                                 ╒▒▌
.                                 ▒▒  .
.                   ╦            (▒▒ ¢╨
.                  ▓▌         ▒N/▒▒░▒▒
.                 Æ▓           ║▒▒▒░░▌
.       ╓        Æ▓▌         ╓Θ║▒╣╢╢╢╢╣▓,         ,╕
.        ╣╕     Æ▓▓ß@@@@@p╗╓Θ▒╫▓╢╣╢╢╣╣╣╢╢▓,,╠   <▒╨
.         ▒▓ ╓░╔▓▓▒╢╣╣╢╢▒▒▒╫╣▓╣╢╣╣╢╣╢╢╣╣╣╣╢╢╫╥▒▒▒
.       ▓ ╙╣╢▓╢▓▓▓╫▒╣╢╢╫╣╢╢╢Ñ▒▒▒▓╣╣╣╢╢╣╢╢╢╢╢▓░░▌
.       ╟▒▄ ╣▒▓▓▓╢▓▓▓▓▒╢╢╫╣╢▓▓▓▓▒╢▓▓▓╢╢▒╫╣╢▒▌▒▒░▒╛
.       ▐╢╢▓▐╫▓▓▓▓░▒╢╢╢╢╢╣▒▒▄▓▓▓▒▒▒▓╫╢▓╣╢╢╢╣▓╜                   ╔æ
.      ╢▒╜▓╣╢@╬╢▓▓@╢╢╣╣╢▓▓▓▓╜▒▒"  ╟╢╫▒▒▒╠╣╣╣▒                  ╔▒╨
.        ╙╟▄▄▄▄▄▒╢╢╣╢╢╢╣▓▓▓▒░▒,    ╝▒▒▒▒▒▓▓▒░▌           ▐┤  ╒▒▒▒▒╢╛
.         ╣▒▓▓▓██▒▒╣▒╣╢╢▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▐╢╢╢▒           Ü▒,╣╣▒▒▒╨
.         ╙▓▀▓▓▓█▌▒╢▓╢▓▓▓""╝▒▒▒▒║▒▒▒▒▒▒▒▒▒╣╣▒▌          ]║▒╢╢╢╢╢╜,
.          ▓ ▓▓▒╢▒▒▓╣▓▀ "▓,  ╙▒▒]╙▒▒▒▒▒▒▒▓╣▌▒å          ▐╢▒▒▒╢╢╢▒╜
.           ▓█░░░▒▒▒▓▀    ╙L    @ ░▒▒▒▒▒▒▐╢╫░▓      ,╥@╬▓▓▓▓╣▓▓▌
.           █░▒▒▒▒▒▒▓      ▒      ░▒▒▒▒▒▒▐╢╢╢▓    ╗╢▒▓▓▓▓╢╫▓▓▓▓╣µ
.          ▓▓▄░▒░╛▒`       ▒      ▒▒▒▒▒▒▒▓╣║▓    ╣▒╫▓▓╢▓▓▓▓▓╢▒▓▓▓▓      ,
.          └∞w▀▀"╒         ▓   ░ ⁿ≡▒▒▒▒▒▓╬▓▒F  ╓╣▒▒╢╣▓▒▒▓▓▒▓╢╢▓▓▒▓▓ ,╗╢╜
.             ▌           ▐   [' ╓╢▒▒▒▒▒▒╢▓▒ ╓╢▒@▓▓▓▓╢▒▒╣▓▒╢▒╢▓▓╢▓╣▌╣▒m┐
.        ▐   ▐            ▓   ░ ,▒▒▒▒▒▒▒▒╣╢╢╔▒▒▓▓╢▓▒▓▓╣╣▓▒╜ '╝▒╢▒╫▓▓╢▒
.         "ⁿ"            ]Γ  ,╕ ]▒▒▒▒▒▒▒╣╢▓▒▓▓▓╢▓▒▒▒╣╢╫█╝     ▒▒╢▓▓▌`"
.                        ╘▌  ▓░"«▒▒▒▒▒▒▓▓▒▒╫▓▓╢╣▓╫▒▓╢▒▒        ░▒▓▓▓
.                          `▐   ║▒▒▒▒▒▒╣╢▓▓╫▒▒▒▓▓▓▓╢▒▒`       ]░▒╢▓▓
.                             ,░▒▒▒▒▒▒▒▒╢╣╣▓╣▒╣╢╢╢▓▒╝          ╜▒▒▓▌
.                            ╙▒░▒▒▒▒▒▒▒▒╣╣▓▓╢╣╣▒▒▒▀            ▒▒╢▓
.                              ╚▒▒▒▒▒▒▒▒╫▓▓▒▒▒▒▒╫           ╓Æ▓▒╢▓▌
.                                `╙╝╣▒▒▒╣▒▒▒▒╝╜           ▄▓▒▒▒╣╢▓▌
.                                                      ,Æ▒▒▒▒▒╢╫▒▓▌
.                                                     Æ▒▒▒▒▒▓╢▓▒╢▓▌
.                                                   ╒▓╜▌╣╫░▒▒▒╢╣▒╢
.                                                         Ñ╝"║▒▒▒▓
.                                                            ╚╜▒▒`
.
.
.
. . Finished! 
GYRADOS

# Flash gyrados upon exiting
trap 'tput cup $row; tput dl 39; printf "$gyrados"; sleep 0.10; \
      tput cup $row; tput dl 39; exit 0' SIGINT

# blink between lokarp and hikarp
while [ -d /proc/$PID ]
do
    tput cup $row 
    tput dl 39
    printf "%s" "$lokarp" 
    sleep 1
    tput cup $row 
    tput dl 39
    printf "%s" "$hikarp" 
    sleep 1
done

# flash gyrados and exit
tput cup $row
tput dl 39
printf "$gyrados"
sleep 0.10
tput cup $row
tput dl 39